

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EZDENTAL-USERS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Merienda:wght@400;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-hMIoyVST+eANF/U9kTKnwCuOZPgLzCUhIEUMy5eeMYgYEmoJmUwHUlaN22v5sAP+D2Lz3hXWGHYQ6dyxKgh4Lg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
    <style>
                /* width */
        ::-webkit-scrollbar {
        width: 10px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
        background: #f1f1f1; 
        }
        
        /* Handle */
        ::-webkit-scrollbar-thumb {
        background: rgb(36,36,36); 
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
        background: #555; 
        }
    </style>
</head>
<body>
    
<div class="container-fluid bg-dark text-light p-3 d-flex align-items-center justify-content-between sticky-top">
    <h3 class="mb-0 h-font">EZDENTAL</h3>
    <a href="index.html" class="btn btn-light btn-sm">LOG OUT</a>
</div>

<div class="col-lg-2 bg-dark border-top border-3 border-secondary" id="Dashboared-menu">
    <nav class="navbar navbar-expand-lg navbar-dark ">
        <div class="container-fluid flex-lg-column align-items-stretch">
            <h4 class="mt-2 text-light">ADMIN PANEL</h4>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#AdminDropdown" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse flex-column align-items-stretch mt-2" id="AdminDropdown">
                <ul class="nav nav-pills flex-column">
                    
                    <li class="nav-item">
                       
                      <a class="nav-link mb-3 text-white" href="user_queries.html">Appointments</a>
                      <a class="nav-link active text-white" href="users.html">Users Info</a>
                    </li>
                  </ul>
            </div>
        </div>
    </nav>
</div>


    <div class="container-fluid" id="main_content">
        <div class="row">
            <div class="col-lg-10 ms-auto p-4 overflow-hidden">
                <h3 class="mb-4">User Details</h3>

                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <!-- Add New Button -->
<div class="text-end mb-4">
    <button id="addNewBtn" class="border-3 bg-dark text-white p-3" data-bs-toggle="modal" data-bs-target="#addUserModal">Add New</button>
</div>

<!-- Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addUserModalLabel">Add New User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="mb-3">
                        <label for="userNameInput" class="form-label">User Name</label>
                        <input type="text" class="form-control" id="userNameInput" required>
                    </div>
                    <div class="mb-3">
                        <label for="emailInput" class="form-label">Email</label>
                        <input type="email" class="form-control" id="emailInput" required>
                    </div>
                    <div class="mb-3">
                        <label for="passwordInput" class="form-label">Password</label>
                        <input type="password" class="form-control" id="passwordInput" required>
                    </div>
                    <div class="mb-3">
                        <label for="typeInput" class="form-label">Type</label>
                        <input type="text" class="form-control" id="typeInput" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>


                    </div>



                        </div>
                        <div class="table-responsive-md" style="height: 450px; overflow-y:scroll;">
                            <table class="table table-hover border">
                                <thead class="sticky-top ">
                                  <tr class="bg-dark text-light">
                                    <th scope="col">#</th>
                                    <th scope="col">UserName</th>
                                    <th scope="col">Email</th>
                                    <th scope="col" >Password</th>
                                    <!-- <th scope="col" width="28%">Messages</th> -->
                                    <th scope="col">type</th>
                                    <th>gender</th>
                                    <!-- <th scope="col">Lat</th>
                                    <th scope="col">Long</th> -->
                                    <th scope="col">Action</th>
                                  </tr>
                                </thead>
                                <tbody id="userList">

                                </tbody>
                                    
                              </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
<!-- Edit User Modal -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editUserModalLabel">Edit User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editUserForm">
                    <input type="hidden" id="editUserEmail">
                    <div class="mb-3">
                        <label for="editUserNameInput" class="form-label">User Name</label>
                        <input type="text" class="form-control" id="editUserNameInput" required>
                    </div>
                    <div class="mb-3">
                        <label for="editEmailInput" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editEmailInput" required disabled>
                    </div>
                    <div class="mb-3">
                        <label for="editPasswordInput" class="form-label">Password</label>
                        <input type="password" class="form-control" id="editPasswordInput" required>
                    </div>
                    <div class="mb-3">
                        <label for="editTypeInput" class="form-label">Type</label>
                        <input type="text" class="form-control" id="editTypeInput" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>

    <script>
        // Initialize Firebase
        var firebaseConfig = {
            apiKey: "AIzaSyAX9iBigv7h-sbTc6YKxm8ArRcq3D33naE",
            authDomain: "ezdental-acd94.firebaseapp.com",
            projectId: "ezdental-acd94",
            storageBucket: "ezdental-acd94.appspot.com",
            messagingSenderId: "961540439243",
            appId: "1:961540439243:web:642d3767eacfca8d35af4e",
            measurementId: "G-P3ZXEHYLN3"
        };
        firebase.initializeApp(firebaseConfig);

        // Initialize Firestore
        const db = firebase.firestore();

        // Reference to the user collection
        const usersCollection = db.collection("users");

        // Fetch all records from the users collection
        usersCollection.get()
            .then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    console.log(doc)
                    // doc.data() is an object representing the document
                    console.log(doc.id, " => ", doc.data());
                    // You can process the data here, for example, display it on the webpage
                });
            })
            .catch((error) => {
                console.log("Error getting documents: ", error);
            });
            // Reference to the tbody element

const tbody = document.getElementById("userList");

        // Function to fetch data from Firestore and populate tbody
        function fetchAndPopulateTable() {
            tbody.innerHTML = "";
            db.collection("users").get()
                .then((querySnapshot) => {
                    let index = 1;
                    querySnapshot.forEach((doc) => {
                        const userData = doc.data();
                        const { email, password,userName, gender, type } = userData;
                        const row = `<tr>
                                        <td>${index++}</td>
                                        <td>${userName}</td>
                                        <td>${email}</td>
                                        <td>${password}</td>
                                        <td>${type}</td>
                                        <td>${gender}</td>
                                        <td>
                                            <button class="btn btn-sm btn-primary" onclick="editUser('${email}')"><i class="fas fa-edit"></i></button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteUser('${email}')"><i class="fas fa-trash-alt"></i></button>
                                        </td>
                                    </tr>`;
                        tbody.innerHTML += row;
                    });
                })
                .catch((error) => {
                    console.log("Error getting documents: ", error);
                });
        }

        // Call the function to fetch data and populate the table
        fetchAndPopulateTable();
        
        // Add event listener for "Add New" button click
const addNewBtn = document.getElementById("addNewBtn");
addNewBtn.addEventListener("click", function(event) {
    event.preventDefault();
    document.getElementById("addUserForm").style.display = "block";
});



function addNewUser(userName, email, password, type) {
        // const tbody = document.getElementById("userList");

        // // Create a new row for the user
        // const newRow = document.createElement("tr");
        // newRow.innerHTML = `
        //     <td>${tbody.children.length + 1}</td>
        //     <td>${userName}</td>
        //     <td>${email}</td>
        //     <td>${password}</td>
        //     <td>${type}</td>
        //     <td>
        //         <button class="btn btn-sm btn-primary" onclick="editUser('${email}')"><i class="fas fa-edit"></i></button>
        //         <button class="btn btn-sm btn-danger" onclick="deleteUser('${email}')"><i class="fas fa-trash-alt"></i></button>
        //     </td>
        // `;

        // // Append the new row to the table body
        // tbody.appendChild(newRow);

        // Add new user data to Firestore
        db.collection("users").add({
            userName: userName,
            email: email,
            password: password,
            type: type
        })
        .then((docRef) => {
            console.log("Document written with ID: ", docRef.id);
            fetchAndPopulateTable();
        })
        .catch((error) => {
            console.error("Error adding document: ", error);
        });
    }


// Event listener for form submission
    const addUserForm = document.getElementById("addUserForm");
    addUserForm.addEventListener("submit", function(event) {
        event.preventDefault();

        // Get form values
        const userName = document.getElementById("userNameInput").value;
        const email = document.getElementById("emailInput").value;
        const password = document.getElementById("passwordInput").value;
        const type = document.getElementById("typeInput").value;

        // Add new user to the table and Firestore
        addNewUser(userName, email, password, type);

        // Reset form fields
        addUserForm.reset();

        // Close modal
        const modal = new bootstrap.Modal(document.getElementById("addUserModal"));
        modal.style.display="hide";
        modal.hide();
    });

    // edit
    // Function to handle edit user action
// Function to handle edit user action
// Function to handle edit user action
function editUser(email) {
    // Query Firestore to find the document with the matching email
    db.collection("users").where("email", "==", email).get()
        .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
                const userData = doc.data();
                const docId = doc.id; // Get the document ID

                // Populate modal with user details
                document.getElementById("editUserEmail").value = email;
                document.getElementById("editUserNameInput").value = userData.userName;
                document.getElementById("editPasswordInput").value = userData.password;
                document.getElementById("editTypeInput").value = userData.type;

                // Show edit user modal
                const modal = new bootstrap.Modal(document.getElementById("editUserModal"));
                modal.show();

                // Add event listener to the edit user form
                const editUserForm = document.getElementById("editUserForm");
                editUserForm.addEventListener("submit", function(event) {
                    event.preventDefault();

                    // Get form values
                    const updatedUserName = document.getElementById("editUserNameInput").value;
                    const updatedPassword = document.getElementById("editPasswordInput").value;
                    const updatedType = document.getElementById("editTypeInput").value;

                    // Update user data in Firestore using the document ID
                    db.collection("users").doc(docId).update({
                        userName: updatedUserName,
                        password: updatedPassword,
                        type: updatedType
                    })
                    .then(() => {
                        console.log("User document successfully updated!");
                        // Close modal
                        modal.hide();
                        fetchAndPopulateTable();
                    })
                    .catch((error) => {
                        console.error("Error updating user document: ", error);
                    });
                });
            });
        })
        .catch((error) => {
            console.error("Error getting user document: ", error);
        });
}



// Wait for the DOM to fully load
document.addEventListener("DOMContentLoaded", function() {
    // Add event listener to the edit user form
    const editUserForm = document.getElementById("editUserForm");
    editUserForm.addEventListener("submit", function(event) {
        event.preventDefault();

        // Get form values
        const email = document.getElementById("editEmailInput").value;
        const userName = document.getElementById("editUserNameInput").value;
        const password = document.getElementById("editPasswordInput").value;
        const type = document.getElementById("editTypeInput").value;
        if (email) {
        // Update user data in Firestore
        db.collection("users").doc(email).update({
            userName: userName,
            password: password,
            type: type
        })
        .then(() => {
            console.log("User document successfully updated!");
            // Close modal
            const modal = new bootstrap.Modal(document.getElementById("editUserModal"));
            modal.hide();
        })
        .catch((error) => {
            console.error("Error updating user document: ", error);
        });
    } else {
        console.error("Email is empty or undefined.");
    }
    });
});

// Function to delete a user document from Firestore using email
function deleteUser(email) {
    if (confirm("Are you sure you want to delete this user?")) {
        // Query Firestore to find the document with the matching email
        db.collection("users").where("email", "==", email).get()
            .then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    // Get the document ID
                    const docId = doc.id;
                    
                    // Delete the document using the document ID
                    db.collection("users").doc(docId).delete()
                        .then(() => {
                            console.log("User document successfully deleted!");
                            // Refresh the table after deletion
                            fetchAndPopulateTable();
                        })
                        .catch((error) => {
                            console.error("Error deleting user document: ", error);
                        });
                });
            })
            .catch((error) => {
                console.error("Error getting user document: ", error);
            });
    }
}



        
        
        </script>
    
    
</body>
</html>